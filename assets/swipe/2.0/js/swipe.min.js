/* Swipe 2.0, (C) Brad Birdsall 2012, MIT license */
function Swipe(r,e){function y(){g=c.children;E=g.length;2>g.length&&(e.continuous=!1);n.transitions&&e.continuous&&3>g.length&&(c.appendChild(g[0].cloneNode(!0)),c.appendChild(c.children[1].cloneNode(!0)),g=c.children);p=Array(g.length);d=r.getBoundingClientRect().width||r.offsetWidth;c.style.width=g.length*d+"px";for(var a=g.length;a--;){var f=g[a];f.style.width=d+"px";f.setAttribute("data-index",a);n.transitions&&(f.style.left=a*-d+"px",l(a,b>a?-d:b<a?d:0,0))}e.continuous&&n.transitions&&(l(h(b-1),-d,0),l(h(b+1),d,0));n.transitions||(c.style.left=b*-d+"px");r.style.visibility="visible"}function B(a,b){n.addEventListener?a.addEventListener("click",b,!1):window.attachEvent&&a.attachEvent("onclick",b)}function C(a){a.returnValue=!1;a.preventDefault&&a.preventDefault()}function K(){for(var a=e.menu.childNodes,f=0;f<a.length;f++)if(a[f].className&&-1!=a[f].className.indexOf("slider-prev"))B(a[f],function(a){C(a);s();F()});else if(a[f].className&&-1!=a[f].className.indexOf("slider-next"))B(a[f],function(a){C(a);s();x()});else if(a[f].className&&-1!=a[f].className.indexOf("slider-menu")){e.menu=a[f];for(var d=0;d<g.length;d++){var c=document.createElement("b");c.innerHTML="\u2022";c.setAttribute("data-index",d);d==b&&(c.className="active");B(c,function(a){return function(b){C(b);s();v(parseInt(this.getAttribute?this.getAttribute("data-index"):a.attributes["data-index"].nodeValue))}}(c));e.menu.appendChild(c)}}}function G(){for(var a=0;a<g.length;a++){var f=e.menu.children[a];f.className=parseInt(f.getAttribute?f.getAttribute("data-index"):f.attributes["data-index"].nodeValue)==b?"active":""}}function F(){e.continuous?v(b-1):b&&v(b-1)}function x(){e.continuous?v(b+1):b<g.length-1&&v(b+1)}function h(a){return(g.length+a%g.length)%g.length}function v(a,f){if(b!=a){if(n.transitions){var c=Math.abs(b-a)/(b-a);if(e.continuous){var k=c,c=-p[h(a)]/d;c!==k&&(a=-c*g.length+a)}for(k=Math.abs(b-a)-1;k--;)l(h((a>b?a:b)-k-1),d*c,0);a=h(a);l(b,d*c,f||q);l(a,0,f||q);e.continuous&&l(h(a-c),-(d*c),0)}else a=h(a),L(b*-d,a*-d,f||q);b=a;e.menu&&G();c=e.callback&&e.callback(b,g[b]);setTimeout(c||z,0)}}function l(a,b,c){t(a,b,c);p[a]=b}function t(a,b,c){if(a=(a=g[a])&&a.style)a.webkitTransitionDuration=a.MozTransitionDuration=a.msTransitionDuration=a.OTransitionDuration=a.transitionDuration=c+"ms",a.webkitTransform="translate("+b+"px,0)translateZ(0)",a.msTransform=a.MozTransform=a.OTransform="translateX("+b+"px)"}function L(a,f,d){if(d)var k=+new Date,l=setInterval(function(){var h=+new Date-k;h>d?(c.style.left=f+"px",u&&(A=setTimeout(x,u)),e.transitionEnd&&e.transitionEnd.call(event,b,g[b]),clearInterval(l)):c.style.left=Math.floor(h/d*100)/100*(f-a)+a+"px"},4);else c.style.left=f+"px"}function s(){u=0;clearTimeout(A)}var z=function(){},n={addEventListener:!!window.addEventListener,touch:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,transitions:function(a){var b=["transitionProperty","WebkitTransition","MozTransition","OTransition","msTransition"],c;for(c in b)if(void 0!==a.style[b[c]])return!0;return!1}(document.createElement("swipe"))};if(r){var c=r.children[0],g,p,d,E;e=e||{};var b=parseInt(e.startSlide,10)||0,q=e.speed||300;e.continuous=void 0!==e.continuous?e.continuous:!0;var u=e.auto||0,A,H,I,J,k,D,w,m={handleEvent:function(a){switch(a.type){case "touchstart":this.start(a);break;case "touchmove":this.move(a);break;case "touchend":var b=this.end(a);setTimeout(b||z,0);break;case "webkitTransitionEnd":case "msTransitionEnd":case "oTransitionEnd":case "otransitionend":case "transitionend":b=this.transitionEnd(a);setTimeout(b||z,0);break;case "resize":setTimeout(y||z,0)}e.stopPropagation&&a.stopPropagation()},start:function(a){a=a.touches[0];H=a.pageX;I=a.pageY;J=+new Date;D=k=w=void 0;c.addEventListener("touchmove",this,!1);c.addEventListener("touchend",this,!1)},move:function(a){if(!(1<a.touches.length||a.scale&&1!==a.scale)){e.disableScroll&&a.preventDefault();var c=a.touches[0];k=c.pageX-H;D=c.pageY-I;"undefined"==typeof w&&(w=!!(w||Math.abs(k)<Math.abs(D)));w||(a.preventDefault(),s(),e.continuous?(t(h(b-1),k+p[h(b-1)],0),t(b,k+p[b],0),t(h(b+1),k+p[h(b+1)],0)):(k/=!b&&0<k||b==g.length-1&&0>k?Math.abs(k)/d+1:1,t(b-1,k+p[b-1],0),t(b,k+p[b],0),t(b+1,k+p[b+1],0)))}},end:function(a){a=250>Number(+new Date-J)&&20<Math.abs(k)||Math.abs(k)>d/2;var f=!b&&0<k||b==g.length-1&&0>k;e.continuous&&(f=!1);var n=0>k;w||(a&&!f?(n?(e.continuous?(l(h(b-1),-d,0),l(h(b+2),d,0)):l(b-1,-d,0),l(b,p[b]-d,q),l(h(b+1),p[h(b+1)]-d,q),b=h(b+1)):(e.continuous?(l(h(b+1),d,0),l(h(b-2),-d,0)):l(b+1,d,0),l(b,p[b]+d,q),l(h(b-1),p[h(b-1)]+d,q),b=h(b-1)),e.menu&&G(),e.callback&&e.callback(b,g[b])):e.continuous?(l(h(b-1),-d,q),l(b,0,q),l(h(b+1),d,q)):(l(b-1,-d,q),l(b,0,q),l(b+1,d,q)));c.removeEventListener("touchmove",m,!1);c.removeEventListener("touchend",m,!1)},transitionEnd:function(a){parseInt(a.target.getAttribute("data-index"),10)==b&&(u&&(A=setTimeout(x,u)),e.transitionEnd&&e.transitionEnd.call(a,b,g[b]))}};y();e.menu&&K();u&&(A=setTimeout(x,u));n.addEventListener?(n.touch&&c.addEventListener("touchstart",m,!1),n.transitions&&(c.addEventListener("webkitTransitionEnd",m,!1),c.addEventListener("msTransitionEnd",m,!1),c.addEventListener("oTransitionEnd",m,!1),c.addEventListener("otransitionend",m,!1),c.addEventListener("transitionend",m,!1)),window.addEventListener("resize",m,!1)):window.onresize=function(){y()};return{setup:function(){y()},slide:function(a,b){s();v(a,b)},prev:function(){s();F()},next:function(){s();x()},stop:function(){s()},getPos:function(){return b},getNumSlides:function(){return E},kill:function(){s();c.style.width="";c.style.left="";for(var a=g.length;a--;){var b=g[a];b.style.width="";b.style.left="";n.transitions&&t(a,0,0)}n.addEventListener?(c.removeEventListener("touchstart",m,!1),c.removeEventListener("webkitTransitionEnd",m,!1),c.removeEventListener("msTransitionEnd",m,!1),c.removeEventListener("oTransitionEnd",m,!1),c.removeEventListener("otransitionend",m,!1),c.removeEventListener("transitionend",m,!1),window.removeEventListener("resize",m,!1)):window.onresize=null}}}}
